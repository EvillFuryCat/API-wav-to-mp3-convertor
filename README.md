# API Wav to mp3 Convertor

## Описание проекта
Это Веб сервис исполненый на Python3, с применением FastAPI. Подключение базе данных Postgres осуществляется с помощью библиотеки SqlAlchemy.

В сервисе определены REST методы:

***create_user*** - Сервис принимает POST запрос, в котором мы передаем имя пользователя,
записывает переданное имя пользователя в базу данных и генерирует для каждого пользователя уникальный UUID токен доступа. Возвращает код 201, имя пользователя и его токен.

Запрос вида:
```
{
  "user_name": "ScaryCat"
} 
```
В ответ вернет
```
{
    "user_name": "ScaryCat",
    "token": "3b3629db-3857-40d2-a287-e8e6a9f8730d"
}
```

***create_audio*** - Сервис принимает POST запрос, в котором мы передаем id пользователя, токен доступа этого пользователя и аудио файл в формате .wav, преобразует аудиозапись в формат mp3,
генерирует для нее уникальный UUID токен и сохраняет их на сервере и в базе данных. Если переданные id и токен пользователя соответствуют тем, что указаны в базе данных,
возвращает код 201 и URL для скачивания записи. Если запись о файле уже присутствует на сервере, не добавляет новую запись в базу данных, а возврaщает код 200 и url для скачивания файла

Выполнить такой запрос можно с помощью автоматически сгенерированной документации swagger по адресу: `http://0.0.0.0:8000/docs#/default/create_audio_record_post` или при помощи Postman.

В программе Postman, следует указать id и токен созданного пользователя, выбрать глагол запроса POST, в параметрах Headers указать `Content-Type: multipart/form-data`, в Body прикрепить аудиофайл формата `.wav`.

 url запроса должен выглядеть примерно так `http://0.0.0.0:8000/record?user_id=4&user_token=5f158639-464d-4733-bc14-eed4e2fa47bf`
 
 ответ будет в JSON формате 
 ```
 {
    "url": "http://0.0.0.0:8000/record?id=4&user_id=4"
}
 ```

***get_upload_record*** - Сервис принимает GET запрос с параметрами id аудиозаписи и id пользователя, позволяет скачать аудиофайл с сервера, например, по url сгенерированным прошлым методом.
Запрос на `http://0.0.0.0:8000/record?id=4&user_id=4`
вернет статус 200 и предложит сохранить аудиофайл на компютере. Если переданные данные не существуют в базе данных, возвращает код 404.
Выполнить такой запрос можно с помощью автоматически сгенерированной документации swagger по адресу: `http://0.0.0.0:8000/docs#/default/get_upload_record_record_get` или при помощи Postman.

В программе Postman следует указать id и токен созданного пользователя, выбрать глагол запроса GET, в параметрах Headers указать `Content-Type: multipart/form-data` и выполнить запрос Send and Download

## Установка зависимостей

Установка зависимостей происходит автоматически с помощью docker Внутри контейнера установится менеджер пакетов poetry, который добавит необходимые библиотеки в docker контейнер

pyproject.toml
```
python = "^3.11"
fastapi = {extras = ["all"], version = "^0.95.2"}
psycopg2-binary = "^2.9.3"
sqlalchemy = "^2.0.13"
requests = "^2.30.0"
black = "^23.3.0"
```
## Сборка Docker образа и запуск сервера

В корне репозитория необходимо выполнить команду

`docker compose up`

Начнется сборка Docker образа и запуск двух изолированных контейнеров api сервиса и отдельно базы данных.
Так как я специально поместил в репозиторий файл .env, дополнительных настроек не потребуется, все переменные окружения, явки и пароли передадутся автоматически.
Это демонстрационный проект, в комерческой разработке подобные данные необходимо тщательно прятать от посторонних глаз и, конечно, создавать базу данных с надежными логином и паролем.
